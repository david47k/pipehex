(()=>{"use strict";var e={204:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.gameManager=t.GameManager=void 0;const n=i(890),a=s(i(579)),r=i(520),l=i(372);function h(e,t){const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="text",i.onload=function(s){const n=i.response;console.log("puzzle file loaded: ",e);let a=[],r=n.split("\n");for(let e of r)e.length>8&&a.push(e);t(a)},i.send(null)}class o{constructor(){this.PUZZLES=new Map,this.puzzleType=a.default.loadStr("puzzleType","5"),this.puzzleIdx=a.default.loadInt("puzzleIdx"+this.puzzleType,0),this.showStats=!1,this.showFPS=!1,this.showTimer=!0,this.showSettings=!1,this.renderSet=new Set,h("/puzzles5.csv",(e=>this.PUZZLES.set("5",e))),h("/puzzles10.csv",(e=>this.PUZZLES.set("10",e))),h("/puzzles15.csv",(e=>this.PUZZLES.set("15",e))),h("/puzzles20.csv",(e=>this.PUZZLES.set("20",e))),h("/puzzles30.csv",(e=>this.PUZZLES.set("30",e))),h("/puzzles40.csv",(e=>this.PUZZLES.set("40",e))),this.game=this.loadGame(parseInt(this.puzzleType)),this.updateStats(),this.view=new n.View(this.game.width,this.game.height),this.restart({restartSolved:!1,restartGame:!1}),this.view.container.addEventListener("contextmenu",(function(e){return e.preventDefault(),!1})),this.view.container.addEventListener("click",(function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1})),this.view.container.addEventListener("mouseup",(function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1})),this.view.container.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var i=t.gameManager,[s,n]=i.game.xyFromPixelCoords(e.offsetX,e.offsetY);return i.game.inBounds(s,n)&&i.click(s,n,e.buttons),!1}))}prevPuzzle(){this.puzzleIdx<=0?console.log("No previous puzzles!"):(this.puzzleIdx--,a.default.saveInt("puzzleIdx"+this.puzzleType,this.puzzleIdx),this.restart())}nextPuzzle(){this.puzzleIdx+1>=this.PUZZLES.get(this.puzzleType).length?console.log("Ran out of puzzles!"):(this.puzzleIdx++,a.default.saveInt("puzzleIdx"+this.puzzleType,this.puzzleIdx),this.restart())}restart({restartSolved:e=!1,restartGame:i=!0}={}){if(this.PUZZLES.has(this.puzzleType)){if(i||0==this.game.width){const e=parseInt(this.puzzleType);this.game=new l.Game({width:e,height:e}),this.game.loadLevelString(this.PUZZLES.get(this.puzzleType)[this.puzzleIdx])}if(!e){let e=a.default.loadMap("highscore"+this.puzzleType,new Map),t=parseInt(e.get(this.puzzleIdx));Number.isInteger(t)&&(this.game.grid=this.game.solvedGrid,this.game.timer=new r.Timer({time:t}),this.game.haveWinCondition()&&this.onWin())}this.view&&(this.view.setUp(this.game.width,this.game.height),this.paintAll()),this.saveGame()}else setTimeout((()=>t.gameManager.restart({restartSolved:e,restartGame:i})),100)}setSize(e){this.puzzleType=e.toString(),a.default.saveStr("puzzleType",this.puzzleType),this.puzzleIdx=a.default.loadInt("puzzleIdx"+this.puzzleType,0),this.updateStats(),this.restart()}updateLoopSet(e=-1,t=[-1]){let i=new Set,s=new Set,n=[];if(-1==e)for(let e=0;e<this.game.height*this.game.width;e++)n.push(e);else{n.push(e);for(let e=0;e<t.length;e++)n.push(t[e]);for(let e=0;e<this.game.height;e++)for(let t=0;t<this.game.width;t++)this.game.grid[e][t].looped&&i.add(this.game.idxFromXy(t,e))}for(;n.length>0;){let e=n.pop();if(-1==e)continue;let[t,i]=this.game.xyFromIdx(e),[a,r]=this.game.getConnectedTiles(t,i,!0);for(const e of a){let t=n.findIndex((t=>t===e));-1!=t&&(n[t]=-1)}for(const e of r){s.add(e);let[t,i]=this.game.xyFromIdx(e);this.game.grid[i][t].looped=!0}}for(const e of i)if(!s.has(e)){let[t,i]=this.game.xyFromIdx(e);this.game.grid[i][t].looped=!1,this.renderSet.add(e)}for(const e of s)i.has(e)||this.renderSet.add(e)}render(e){this.game.ts=e,this.game.timer.update(e),this.view.render()}paintAll(){this.renderSet=new Set,this.updateLoopSet();for(let e=0;e<this.game.height*this.game.width;e++)this.renderSet.add(e)}saveGame(){a.default.saveObj("savegame",this.game)}loadGame(e){this.showTimer="true"===a.default.loadStr("showTimer","true"),this.showFPS="true"===a.default.loadStr("showFPS","false");let t=a.default.loadObj("savegame",{width:0,height:0});return new l.Game(t)}speedTest(){this.setSize(30),this.puzzleIdx=0,this.restart({restartSolved:!0}),Date.now();for(let e=0;e<6;e++)for(let e=0;e<30;e++)this.click(e,e,0),this.render(this.game.tsPrior);let e=Date.now();for(let e=0;e<6;e++)for(let e=0;e<30;e++)this.click(e,e,0),this.render(this.game.tsPrior);let t=Date.now(),i=a.default.loadObj("speedTest",[0,0,0]),s=t-e,n=(i[0]+i[1]+i[2])/3;console.log("Last 3 avg (ms): ",n),console.log("This test  (ms): ",s),console.log("Difference (ms): ",s-n),i.shift(),i.push(s),a.default.saveObj("speedTest",i)}updateStats(){let e=[...a.default.loadMap("highscore"+this.puzzleType,new Map).values()];e.sort(((e,t)=>e-t));let t=this.puzzleType+"x"+this.puzzleType,i="tbd",s="tbd",n="tbd",l="tbd";e.length>=1&&(i=(0,r.timestringFrom)(e[0])),e.length>=3&&(s=(0,r.timestringFrom)(e.slice(0,3).reduce(((e,t)=>e+t),0)/3)),e.length>=5&&(n=(0,r.timestringFrom)(e.slice(0,5).reduce(((e,t)=>e+t),0)/5)),e.length>=10&&(l=(0,r.timestringFrom)(e.slice(0,10).reduce(((e,t)=>e+t),0)/10)),this.stats={puztype:t,num:e.length.toString(),best:i,best3:s,best5:n,best10:l}}onWin(){this.game.timer.stop(this.game.tsPrior),this.game.wintime=this.game.timer.timestring(),document.getElementById("wintime").innerHTML=this.game.wintime;let e=a.default.loadMap("highscore"+this.puzzleType,new Map);e.set(this.puzzleIdx,Math.trunc(this.game.timer.getMillis())),a.default.saveMap("highscore"+this.puzzleType,e),this.updateStats(),0==this.game.winningAnimation.started&&(this.game.winningAnimation.started=!0,this.game.winningAnimation.start_ts=this.game.ts)}click(e,t,i){if(!this.game.won){0==i||1==i?this.game.grid[t][e].rotate():2==i&&this.game.grid[t][e].rotate(!0),this.renderSet.add(this.game.idxFromXy(e,t)),this.game.timer.start(this.game.tsPrior);let s=this.game.getSurroundingTiles(e,t);for(;s.length>0;){let e=s.pop(),[t,i]=this.game.xyFromIdx(e);this.game.isIsolated(t,i)?0==this.game.grid[i][t].isolated&&(this.game.grid[i][t].isolated=!0,this.game.grid[i][t].color=n.PALETTE_ANNEX,this.renderSet.add(this.game.idxFromXy(t,i))):1==this.game.grid[i][t].isolated&&(this.renderSet.add(this.game.idxFromXy(t,i)),this.game.grid[i][t].isolated=!1)}this.updateLoopSet(t*this.game.width+e,s);let[a,r]=this.game.getConnectedTiles(e,t,!0),l=this.game.grid[t][e].color;if(a.size<=1)this.game.grid[t][e].isolated=!0,l=n.PALETTE_ANNEX;else{this.game.grid[t][e].isolated=!1;let i=a.values();i.next();let s=i.next().value;l=this.game.tileFromIdx(s).color,l==n.PALETTE_ANNEX&&(l=(t*this.game.width+e)%n.PALETTE.length)}for(let e of a){let t=Math.trunc(e/this.game.width),i=e%this.game.width;this.game.grid[t][i].color!=l&&(this.game.grid[t][i].color=l,this.renderSet.add(e))}this.game.haveWinCondition()&&this.onWin()}this.render(this.game.ts),this.saveGame()}}t.GameManager=o,t.gameManager=new o,Object.defineProperty(window,"gameManager",{value:t.gameManager,writable:!0})},372:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const s=i(520),n=i(794),a=i(131);t.Game=class{constructor(e={}){this.width=0,this.height=0,this.grid=null,this.solvedGrid=null,this.won=!1,this.title="(puzzle title)",this.timer=new s.Timer,this.wintime="";for(const[t,i]of Object.entries(e))e.hasOwnProperty(t)&&Object.defineProperty(this,t,{value:Object.getOwnPropertyDescriptor(e,t).value,writable:!0});this.grid=this.newGrid(this.grid),this.timer=new s.Timer(this.timer),this.tileW=56,this.tileH=64,this.tileVO=3*this.tileH/4,this.tsPrior=0,this.ts=0,this.winningAnimation={started:!1,start_ts:0}}tileFromIdx(e){let t=~~(e/this.width),i=e%this.width;return this.grid[t][i]}xyFromIdx(e){let t=~~(e/this.width);return[e%this.width,t]}idxFromXy(e,t){return t*this.width+e}newGrid(e=null){let t=[];for(let i=0;i<this.height;i++){let s=[];for(let t=0;t<this.width;t++)null==e?s.push(new n.Tile):s.push(new n.Tile(e[i][t]));t.push(s)}return t}newGridFromPuzstr(e){let t=this.newGrid(),i=e.split("");for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++){let n=[0,0,0,0,0,0],a=i[e*this.width+s],r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-".indexOf(a);1==(1&r)&&(n[0]=1),2==(2&r)&&(n[1]=1),4==(4&r)&&(n[2]=1),8==(8&r)&&(n[3]=1),16==(16&r)&&(n[4]=1),32==(32&r)&&(n[5]=1),t[e][s].setup(n)}return t}haveWinCondition(){if(!Array.isArray(this.solvedGrid))return!1;for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)if(!(0,a.arrayEqual)(this.grid[e][t].conns,this.solvedGrid[e][t].conns))return!1;return this.won=!0,!0}pause(e){return this.timer.running?(this.timer.stop(e),!0):(this.timer.start(e),!1)}loadLevelString(e){let[t,i,s,n,a]=e.split(",");this.title=t,this.width=parseInt(i),this.height=parseInt(s),this.grid=this.newGridFromPuzstr(n),this.solvedGrid=this.newGridFromPuzstr(a)}xyFromPixelCoords(e,t){let i=Math.floor(t/this.tileVO),s=t%this.tileVO/this.tileVO,n=0;i%2==1&&(n=this.tileW/2);let a=Math.floor((e-n)/this.tileW),r=(e-n)%this.tileW/this.tileW;if(s<1/3){let e=3*s;r<.5?2*r<1-e&&(i%2==0&&(a-=1),i-=1):2*(r-.5)>e&&(i%2==0&&(a-=1),i-=1,a+=1)}return[a,i]}inBounds(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}invertAngle(e){return e>2?e-3:e+3}xyAtAngle(e,t,i){let s=e,n=t;return 0==i?s++:1==i?(t%2==0||s++,n++):2==i?t%2==0?(s--,n++):n++:3==i?s--:4==i?t%2==0?(s--,n--):n--:5==i&&(t%2==0||s++,n--),s<0||s>this.width-1||n<0||n>this.height-1?null:[s,n]}isIsolated(e,t){for(let i=0;i<6;i++){if(!this.grid[t][e].conns[i])continue;let s=this.xyAtAngle(e,t,i);if(null==s)continue;let[n,a]=s;if(this.grid[a][n].conns[this.invertAngle(i)])return!1}return!0}getSurroundingTiles(e,t){let i=[];for(let s=0;s<6;s++){let n=this.xyAtAngle(e,t,s);if(null==n)continue;let[a,r]=n,l=this.idxFromXy(a,r);i.push(l)}return i}getConnectedTiles(e,t,i){class s{constructor(e,t,i,s){this.x=e,this.y=t,this.fromangle=i,this.angle=s}}let n=[new s(e,t,null,0)],a=new Set;a.add(t*this.width+e);let r=new Set;for(;n.length>0;){let e=n.pop(),t=e.x,l=e.y,h=e.fromangle,o=e.angle;if(o>5)continue;if(n.push(new s(t,l,h,o+1)),null!=h&&h==o)continue;if(!this.grid[l][t].conns[o])continue;let d=this.xyAtAngle(t,l,o);if(null==d)continue;let[g,m]=d;if(this.grid[m][g].conns[this.invertAngle(o)])if(a.has(m*this.width+g)){let e=0;for(e=0;e<n.length&&(n[e].x!=g||n[e].y!=m);e++);if(e==n.length);else for(let t=e;t<n.length;t++)r.add(n[t].y*this.width+n[t].x)}else a.add(m*this.width+g),i&&n.push(new s(g,m,this.invertAngle(o),0))}return[a,r]}}},138:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=i(204),a=s(i(579)),r=i(131);document.getElementById("restart_button").addEventListener("click",(function(){n.gameManager.restart({restartSolved:!0})})),document.getElementById("prev_puzzle").addEventListener("click",(function(){n.gameManager.prevPuzzle()}));let l=document.getElementsByClassName("next_puzzle");for(let e=0;e<l.length;e++)l.item(e).addEventListener("click",(function(){n.gameManager.nextPuzzle()}));document.getElementById("pause").addEventListener("click",(function(e){const t=n.gameManager.game.pause(n.gameManager.game.tsPrior);(0,r.setAriaPressed)(e.target,t)})),document.getElementById("show_fps").addEventListener("click",(function(e){n.gameManager.showFPS=!n.gameManager.showFPS;const t=n.gameManager.showFPS;let i=document.getElementById("menu_fps"),s=document.getElementById("show_fps");(0,r.setAriaPressed)(s,t),(0,r.setHideClass)(i,t),a.default.saveStr("showFPS",t.toString())})),document.getElementById("show_timer").addEventListener("click",(function(e){n.gameManager.showTimer=!n.gameManager.showTimer;const t=n.gameManager.showTimer;let i=document.getElementById("menu_time"),s=document.getElementById("show_timer");(0,r.setAriaPressed)(s,t),(0,r.setHideClass)(i,t),a.default.saveStr("showTimer",t.toString())})),document.getElementById("settings_button").addEventListener("click",(function(e){n.gameManager.showSettings=!n.gameManager.showSettings;const t=n.gameManager.showSettings;let i=document.getElementById("settings_menu");(0,r.setAriaPressed)(e.target,t),(0,r.setHideClass)(i,t)})),document.getElementById("stats_button").addEventListener("click",(function(e){n.gameManager.showStats=!n.gameManager.showStats;const t=n.gameManager.showStats;let i=document.getElementById("stats");(0,r.setAriaPressed)(e.target,t),(0,r.setHideClass)(i,t)}));let h=document.getElementById("settings_game_size");Array.prototype.forEach.call(h.children,(e=>{e.addEventListener("click",(function(t){const i=Number.parseInt(e.getAttribute("data"));n.gameManager.setSize(i)}))})),function e(t){window.requestAnimationFrame(e),n.gameManager.render(t)}(0)},670:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PATTERNS5=void 0,t.PATTERNS5=[[0,1,0,1,0,2,3,2,3,2,4,5,4,5,4,6,7,6,7,6,8,9,8,9,8],[0,1,2,3,4,0,1,2,3,4,0,1,2,3,4,0,1,2,3,4,0,1,2,3,4],[3,2,2,2,3,2,1,1,2,3,2,1,0,1,2,2,1,1,2,3,3,2,2,2,3],[0,1,1,1,0,1,2,2,1,0,1,2,3,2,1,1,2,2,1,0,0,1,1,1,0],[0,1,2,3,4,1,2,3,4,5,1,2,3,4,5,2,3,4,5,6,2,3,4,5,6],[0,9,9,9,0,9,0,0,9,0,9,0,0,0,9,9,0,0,9,0,0,9,9,9,0],[0,1,2,3,4,19,18,17,16,15,1,2,3,4,5,0,19,18,17,16,2,3,4,5,6],[0,1,2,3,4,15,16,17,18,5,14,3,4,19,6,13,2,1,0,7,12,11,10,9,8],[0,8,0,8,0,0,0,0,0,0,8,0,0,0,8,8,0,0,8,0,0,8,8,8,0],[17,17,1,17,17,17,2,2,17,17,17,3,3,3,17,4,4,4,4,17,5,5,5,5,5]]},579:(e,t)=>{function i(e,t){return t instanceof Map?{dataType:"Map",val:Array.from(t.entries())}:t}function s(e,t){return"object"==typeof t&&null!==t&&"Map"===t.dataType?new Map(t.val):t}Object.defineProperty(t,"__esModule",{value:!0}),t.default={save:function(e,t){localStorage.setItem("phex_"+e,t)},saveInt:function(e,t){this.save(e,t)},saveStr:function(e,t){this.save(e,t)},saveMap:function(e,t){localStorage.setItem("phex_"+e,JSON.stringify(t,i))},loadMap:function(e,t){var i=localStorage.getItem("phex_"+e);return null==i?t:JSON.parse(i,s)},loadInt:function(e,t){var i=parseInt(localStorage.getItem("phex_"+e));return isNaN(i)?t:i},loadStr:function(e,t){let i=localStorage.getItem("phex_"+e);return null==i?t:i},saveObj:function(e,t){localStorage.setItem("phex_"+e,JSON.stringify(t))},loadObj:function(e,t){var i=localStorage.getItem("phex_"+e);return null==i?t:JSON.parse(i)}}},794:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=void 0;const s=i(131),n=i(890);function a(){return Math.trunc(2*Math.random())}const r=[[0,0,0,0,0,0],[1,0,0,0,0,0],[1,1,0,0,0,0],[1,0,1,0,0,0],[1,0,0,1,0,0],[1,1,1,0,0,0],[1,0,1,1,0,0],[1,0,0,1,1,0],[1,0,1,0,1,0],[1,1,1,1,0,0],[1,0,1,1,1,0],[1,1,0,1,1,0],[1,1,1,1,1,0],[1,1,1,1,1,1]];function l(e,t){for(var i=t,n=0;n<6;n++){if((0,s.arrayEqual)(i,e))return{m:!0,a:n};i=[i[5],i[0],i[1],i[2],i[3],i[4]]}return{m:!1,a:0}}function h(e){let t=0,i=0,s=0;for(let n=0;n<6;n++)1==e[n]&&(t++,s||(i=n,s=1));let n=0;if(1==t)n=1;else if(t>=2&&t<=5)for(let t=2;t<=12;t++){const s=l(e,r[t]);if(1==s.m){n=t,i=s.a;break}}else 6==t&&(n=13);return{s:n,a:i}}t.Tile=class{constructor({conns:e=[a(),a(),a(),a(),a(),a()],color:t=n.PALETTE_ANNEX,isolated:i=!0,locked:s=!1,looped:r=!1}={}){this.conns=e;let l=h(this.conns);this.shape=l.s,this.angle=l.a,this.color=t,this.isolated=i,this.locked=s,this.looped=r}rotate(e=!1){e?(this.conns=[this.conns[1],this.conns[2],this.conns[3],this.conns[4],this.conns[5],this.conns[0]],this.angle--,-1==this.angle&&(4==this.shape?this.angle=2:8==this.shape?this.angle=1:11==this.shape?this.angle=2:13==this.shape?this.angle=0:this.angle=5)):(this.conns=[this.conns[5],this.conns[0],this.conns[1],this.conns[2],this.conns[3],this.conns[4]],this.angle++,6==this.angle&&(this.angle=0),(4==this.shape&&3==this.angle||8==this.shape&&2==this.angle||11==this.shape&&3==this.angle||13==this.shape)&&(this.angle=0))}setup(e){this.conns=e;const t=h(this.conns);this.shape=t.s,this.angle=t.a}equal(e){this.conns.every(((t,i)=>t==e.conns[i]))}}},520:(e,t)=>{function i(e){let t=Math.trunc(e/1e3);const i=Math.trunc(t/60);t-=60*i;let s=t.toString();return s.length<2&&(s="0"+s),i.toString()+":"+s}Object.defineProperty(t,"__esModule",{value:!0}),t.Timer=t.timestringFrom=void 0,t.timestringFrom=i,t.Timer=class{constructor({time:e=0}={}){this.time=e,this.timestamp=0,this.running=!1}start(e){this.running?this.update(e):(this.timestamp=e,this.running=!0)}stop(e){this.running&&(this.update(e),this.running=!1)}reset(){this.running=!1,this.time=0}update(e){if(this.running){const t=e-this.timestamp;t>=0?this.time+=t:console.log("time has gone backwards"),this.timestamp=e}}getMillis(){return this.time}timestring(){return i(this.time)}}},131:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setHideClass=t.setAriaPressed=t.arrayEqual=void 0,t.arrayEqual=function e(t,i){return Array.isArray(t)&&Array.isArray(i)?t.length===i.length&&t.every(((t,s)=>e(t,i[s]))):t===i},t.setAriaPressed=function(e,t){e instanceof HTMLButtonElement&&e.setAttribute("aria-pressed",t.toString())},t.setHideClass=function(e,t){t?e.classList.remove("hide"):e.classList.add("hide")}},890:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.View=t.PALETTE_B=t.PALETTE_ANNEX=t.PALETTE=void 0;const s=i(204),n=i(131),a=i(670);t.PALETTE=["#d99a94","#da9d80","#d4a46e","#cbab5d","#bfb351","#b5b94e","#a6bf5a","#92c477","#83c596","#7ec4a5","#79c3b6","#77c0c8","#7dbbd8","#89b4e1","#9aade4","#aea4e2","#bc9fd8","#ca9ac8","#cf98bf","#d798a4"],t.PALETTE_ANNEX=20,t.PALETTE_B=["#a0a0a0","#555555","#333333","#000000"],t.View=class{constructor(e,t){this.gameWidth=e,this.gameHeight=t,this.container=document.getElementById("container"),this.drawMethod=1,this.alwaysRenderAll=0,this.canvasCache=new Map,this.hexTileMask=null,this.tileH=64,this.tileVO=48,this.tileW=56,this.setUp(e,t)}setUp(e,t){if(!s.gameManager)return void setTimeout((()=>{this.setUp(e,t)}),10);console.log("setting up..."),this.renderButtons(),this.gameWidth=e,this.gameHeight=t;let{width:i,height:n}=this.container.getBoundingClientRect();n=document.documentElement.clientHeight-15;const[a]=this.container.children;a&&this.container.removeChild(a);let r=e*this.tileW+Math.floor(this.tileW/2),l=(t+1)*this.tileVO-this.tileH/2;const h=document.createElement("canvas");this.container.appendChild(h),this.context=h.getContext("2d",{alpha:!1}),h.setAttribute("width",""+r),h.setAttribute("height",""+l),document.body.style.minWidth=r+"px",this.renderStats()}renderButtons(){(0,n.setAriaPressed)(document.getElementById("show_fps"),s.gameManager.showFPS),(0,n.setHideClass)(document.getElementById("menu_fps"),s.gameManager.showFPS),(0,n.setAriaPressed)(document.getElementById("show_timer"),s.gameManager.showTimer),(0,n.setHideClass)(document.getElementById("menu_time"),s.gameManager.showTimer)}renderFromCanvas(e,t,i,s){s%2==1&&(i+=.5),t&&t.drawImage(e,0,0,this.tileW,this.tileH,Math.floor(this.tileW*i),this.tileVO*s,this.tileW,this.tileH)}clearHex(e,t,i){i%2==1&&(t+=.5),null==this.hexTileMask&&this.generateHexTileMask();let s=e.getImageData(Math.floor(this.tileW*t),this.tileVO*i,this.tileW,this.tileH);for(let e=0;e<this.tileW*this.tileH;e++){const t=4*e;0!==this.hexTileMask[e]&&s.data.fill(0,t,t+4)}e.putImageData(s,Math.floor(this.tileW*t),this.tileVO*i)}getHexCanvas(e=t.PALETTE_ANNEX+2){const i=e+65536;if(this.canvasCache.has(i))return this.canvasCache.get(i);let s=document.createElement("canvas"),n=s.getContext("2d"),a=this.tileW,r=this.tileH;s.setAttribute("width",a.toString()),s.setAttribute("height",r.toString()),e>=t.PALETTE_ANNEX?n.fillStyle=t.PALETTE_B[e-t.PALETTE_ANNEX]:n.fillStyle=t.PALETTE[e],n.strokeStyle=t.PALETTE_B[3],n.lineWidth=1,n.translate(.5,.5),n.beginPath();let l=r-1,h=a-1;return n.moveTo(h/2,0),n.lineTo(h,l/4),n.lineTo(h,3*l/4),n.lineTo(h/2,l),n.lineTo(0,3*l/4),n.lineTo(0,l/4),n.lineTo(h/2,0),n.fill(),n.stroke(),n.translate(0,0),this.canvasCache.set(i,s),s}applyHexTileMask(e){null==this.hexTileMask&&this.generateHexTileMask();let t=e.getImageData(0,0,this.tileW,this.tileH);for(let e=0;e<this.tileW*this.tileH;e++){const i=4*e+3;t.data[i]=this.hexTileMask[e]}e.putImageData(t,0,0)}applyHexTileBorderMask(e){null==this.hexTileMask&&this.generateHexTileMask();let t=e.getImageData(0,0,this.tileW,this.tileH);for(let e=0;e<this.tileW*this.tileH;e++){const i=4*e+3;0===this.hexTileMask[e]&&(t.data[i]=0)}e.putImageData(t,0,0)}generateHexTileMask(){let e=new Uint8ClampedArray(this.tileW*this.tileH),t=27;for(let i=0;i<=15;i++){[3,6,10,13].some((e=>e==i))&&(t+=1);let s=i*this.tileW+t,n=(i+1)*this.tileW-t;e.fill(255,s,n),s=(this.tileH-1-i)*this.tileW+t,n=(this.tileH-i)*this.tileW-t,e.fill(255,s,n),t-=2}let i=16*this.tileW,s=(this.tileH-16)*this.tileW;e.fill(255,i,s),this.hexTileMask=e}getLineCanvas(e,i){let s=0;for(let t=0;t<6;t++)e[t]&&(s|=1<<t);if(s|=i<<6,this.canvasCache.has(s))return this.canvasCache.get(s);let n=document.createElement("canvas"),a=n.getContext("2d"),r=this.tileW,l=this.tileH;n.setAttribute("width",r.toString()),n.setAttribute("height",l.toString()),a.lineCap="butt",a.lineJoin="bevel",a.clearRect(0,0,r,l),i>=t.PALETTE_ANNEX?(a.fillStyle=t.PALETTE_B[i-t.PALETTE_ANNEX],a.strokeStyle=t.PALETTE_B[i-t.PALETTE_ANNEX]):(a.fillStyle=t.PALETTE[i],a.strokeStyle=t.PALETTE[i]),a.lineWidth=l/8;let h=0,o=l,d=r;for(let t=0;t<e.length;t++){if(!e[t])continue;h++,a.beginPath(),a.moveTo(d/2,o/2);let i=d/2,s=o/2,n=0,r=4*n/7;0==t?i=d:1==t?(s=7*o/8+n,i=3*d/4+r):2==t?(s=7*o/8+n,i=1*d/4-r):3==t?i=0:4==t?(s=1*o/8-n,i=1*d/4-r):5==t&&(s=1*o/8-n,i=3*d/4+r),a.lineTo(i,s),a.stroke()}let g=l/16;return 1==h&&(g=l/8),a.beginPath(),a.moveTo(d/2,o/2),a.arc(d/2,o/2,g,0,2*Math.PI,!0),a.fill(),this.canvasCache.set(s,n),n}renderStats(){if(s.gameManager&&s.gameManager.stats){const e=s.gameManager.stats;document.getElementById("stats_size").innerHTML=e.puztype,document.getElementById("stats_num").innerHTML=e.num,document.getElementById("stats_best").innerHTML=e.best,document.getElementById("stats_best3").innerHTML=e.best3,document.getElementById("stats_best5").innerHTML=e.best5,document.getElementById("stats_best10").innerHTML=e.best10}}render(){let e=s.gameManager;if(!e)return void console.log("view::render() called with no gamemanager initialised");if(!this.context)return;let i=s.gameManager.game,n=s.gameManager.game.ts;(this.alwaysRenderAll||e.game.winningAnimation.started)&&e.paintAll();for(const s of e.renderSet){const[r,l]=e.game.xyFromIdx(s);if(0==this.drawMethod);else if(1==this.drawMethod){let s=null;if(e.game.winningAnimation.started&&5==this.gameWidth&&5==this.gameHeight){let i=e.puzzleIdx%a.PATTERNS5.length,h=Math.floor((n-e.game.winningAnimation.start_ts)/100)+a.PATTERNS5[i][l*this.gameWidth+r];h=Math.floor(h)%t.PALETTE.length,s=this.getHexCanvas(h)}else if(e.game.winningAnimation.started){let i=Math.floor((n-e.game.winningAnimation.start_ts)/100)+l;i=Math.floor(i)%t.PALETTE.length,s=this.getHexCanvas(i)}else s=i.grid[l][r].looped?this.getHexCanvas(t.PALETTE_ANNEX+1):this.getHexCanvas(t.PALETTE_ANNEX+2);this.renderFromCanvas(s,this.context,r,l);let h=e.game.grid[l][r].color,o=this.getLineCanvas(i.grid[l][r].conns,h);this.renderFromCanvas(o,this.context,r,l)}}if(e.renderSet.clear(),s.gameManager.showFPS){let e=Math.floor(1e3/(n-i.tsPrior));document.getElementById("fps_text").innerHTML=""+e}i.tsPrior=n,document.getElementById("puzzle_title").innerHTML=i.title,document.getElementById("timer_text").innerHTML=i.timer.timestring(),i.won?(document.getElementById("wintime").innerHTML=i.wintime,document.getElementById("winner").classList.remove("hide"),this.renderStats()):document.getElementById("winner").classList.add("hide");const r=!s.gameManager.game.timer.running;document.getElementById("pause").setAttribute("aria-pressed",r.toString())}}}},t={};!function i(s){var n=t[s];if(void 0!==n)return n.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,i),a.exports}(138)})();